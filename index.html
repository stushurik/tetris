<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title></title>
    <script src="tetris.js"></script>
</head>
<body>
    <canvas id="well" height='540' width='300' style="border:1px solid #000000;" tabindex='1' >Обновите браузер</canvas>

    <script>

        function getRandomInt(min, max) {
            return Math.floor(Math.random() * (max - min)) + min;
        }

        var well = document.getElementById("well");
        var ctx = well.getContext('2d');

        var figures = [I,J,L,O,T,S,Z];


        var timer = setTimeout(function run() {

            var figure = new figures[getRandomInt(0,6)]({context: ctx});

            var keyboardCallbackFunc = function(event){

                event.stopImmediatePropagation();

                if (event.keyCode == 38) {

                    figure.rotate();

                }

                if (event.keyCode == 40) {

                    figure.drop();

                }

                if (event.keyCode == 39) {

                    figure.move({offsetX:1, directionX: true});

                }

                if (event.keyCode == 37) {

                    figure.move({offsetX:1, directionX: false});

                }

            };

            var canvas = document.getElementById("well");
            canvas.addEventListener( "keydown", keyboardCallbackFunc, true);

            figure.drawAllRect();

            function makeStep(){

                var toRemove = [];

                if (figure.checkBottom()){
                    figure.move({});
                    setTimeout(makeStep, 1000);
                } else {
                    figure.toWell();

                    (function(){

                        for (var i=17; i>=0; i--){

                            var isFull = true;

                            for (var j=0; j<10; j++){

                                var cell = figure.well[i][j];
                                isFull = isFull && cell

                            }

                            if (isFull){
                               toRemove.push(i);
                               for (var k=0; k<10; k++){

                                   figure.well[i][k].clear();

                               }
                            }

                        }

                    })();

                    if (toRemove.length){



                    }

                    canvas.removeEventListener( "keydown", keyboardCallbackFunc, true);
                    timer = setTimeout(run, 10);
                }
            }

            makeStep();

        }, 10);

    </script>
</body>
</html>